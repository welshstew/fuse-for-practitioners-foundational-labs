<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring
       http://camel.apache.org/schema/spring/camel-spring.xsd">

    <bean id="breakBean" class="org.BreakBean"/>

    <bean id="myDeadLetterErrorHandler" class="org.apache.camel.builder.DeadLetterChannelBuilder">
        <property name="deadLetterUri" value="file://{{fileError}}"/>
        <property name="redeliveryPolicy" ref="myRedeliveryPolicyConfig"/>
    </bean>

    <bean id="myRedeliveryPolicyConfig" class="org.apache.camel.processor.RedeliveryPolicy">
        <property name="maximumRedeliveries" value="2"/>
        <property name="redeliveryDelay" value="500"/>
    </bean>


    <camelContext trace="false" xmlns="http://camel.apache.org/schema/spring"
                  errorHandlerRef="myDeadLetterErrorHandler">

        <propertyPlaceholder location="fabric8/route.properties" id="properties"/>

        <dataFormats>
            <bindy id="bindy1" type="Csv" classType="org.acme.Customer"/>
        </dataFormats>

        <route id="customerInput">
            <from uri="file://{{fileInput}}"/>
            <split>
                <tokenize token="\n"/>
                <unmarshal ref="bindy1"/>
                <transform>
                    <groovy>resource:classpath:transform.groovy</groovy>
                </transform>
                <log message="${body}"/>
                <to uri="file://{{fileOutput}}"/>
            </split>
        </route>

    </camelContext>
</beans>